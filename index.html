<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì¥ ì‘ì—…ì í¬ì¦ˆ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        const WorkerPoseAnalyzer = () => {
          // State ê´€ë¦¬
          const [isRunning, setIsRunning] = useState(false);
          const [statusMessage, setStatusMessage] = useState('í´§ í¬ì¦ˆ ë¶„ì„ì€ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥, VLM ë¶„ì„ì€ API í‚¤ ì„¤ì • í›„ ê°€ëŠ¥');
          const [statusType, setStatusType] = useState('warning');
          const [showMetrics, setShowMetrics] = useState(false);
          const [showVLMAnalysis, setShowVLMAnalysis] = useState(false);
          const [showSnapshot, setShowSnapshot] = useState(false);
          const [showRecommendations, setShowRecommendations] = useState(false);
          const [metrics, setMetrics] = useState({
            spineAngle: 0,
            neckAngle: 0,
            shoulderBalance: 0,
            kneeAngle: 0,
            workIntensity: 'ë³´í†µ'
          });
          const [vlmAnalysis, setVlmAnalysis] = useState('');
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [recommendations, setRecommendations] = useState([]);

          // Refs
          const videoRef = useRef(null);
          const canvasRef = useRef(null);
          const snapshotCanvasRef = useRef(null);
          const poseRef = useRef(null);
          const cameraRef = useRef(null);

          // í´‘ API ì„¤ì • (ì—¬ê¸°ì„œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”!)
          const config = {
            // OpenAI GPT-4 Vision ì„¤ì •
            openai: {
              apiKey: 'sk-your-openai-api-key-here', // â† ì‹¤ì œ OpenAI API í‚¤ ì…ë ¥
              model: 'gpt-4-vision-preview'
            },
            
            // Google Gemini ì„¤ì •  
            gemini: {
              apiKey: 'your-gemini-api-key-here', // â† ì‹¤ì œ Gemini API í‚¤ ì…ë ¥
              model: 'gemini-pro-vision'
            },
            
            // Anthropic Claude ì„¤ì •
            claude: {
              apiKey: 'your-claude-api-key-here', // â† ì‹¤ì œ Claude API í‚¤ ì…ë ¥
              model: 'claude-3-sonnet-20240229'
            },
            
            // ì‚¬ìš©í•  VLM ì„ íƒ ('openai', 'gemini', 'claude')
            selectedVLM: 'openai'
          };

          const selectedConfig = config[config.selectedVLM];
          const hasValidApiKey = selectedConfig.apiKey && !selectedConfig.apiKey.includes('your-') && !selectedConfig.apiKey.includes('-here');

          // ê°ë„ ê³„ì‚° í•¨ìˆ˜
          const calculateAngle = useCallback((point1, point2, point3) => {
            const a = Math.sqrt(Math.pow(point2.x - point3.x, 2) + Math.pow(point2.y - point3.y, 2));
            const b = Math.sqrt(Math.pow(point1.x - point3.x, 2) + Math.pow(point1.y - point3.y, 2));
            const c = Math.sqrt(Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2));
            
            const angle = Math.acos((a * a + c * c - b * b) / (2 * a * c));
            return angle * 180 / Math.PI;
          }, []);

          // ì‹¤ì œ í¬ì¦ˆ ë©”íŠ¸ë¦­ ê³„ì‚°
          const calculateRealPoseMetrics = useCallback((landmarks) => {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const nose = landmarks[0];
            const leftKnee = landmarks[25];
            const leftAnkle = landmarks[27];

            // ì²™ì¶” ê°ë„ ê³„ì‚°
            const shoulderMidpoint = {
              x: (leftShoulder.x + rightShoulder.x) / 2,
              y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipMidpoint = {
              x: (leftHip.x + rightHip.x) / 2,
              y: (leftHip.y + rightHip.y) / 2
            };

            const spineAngle = calculateAngle(
              shoulderMidpoint,
              hipMidpoint,
              {x: hipMidpoint.x, y: hipMidpoint.y + 0.1}
            );

            // ëª© ê°ë„ ê³„ì‚°
            const neckAngle = calculateAngle(
              nose,
              shoulderMidpoint,
              {x: shoulderMidpoint.x, y: shoulderMidpoint.y + 0.1}
            );

            // ì–´ê¹¨ ê· í˜• ê³„ì‚°
            const shoulderBalance = Math.abs(leftShoulder.y - rightShoulder.y) * 180;

            // ë¬´ë¦ ê°ë„ ê³„ì‚°
            const kneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);

            return {
              spineAngle: 180 - Math.abs(spineAngle),
              neckAngle: Math.abs(neckAngle),
              shoulderBalance: shoulderBalance,
              kneeAngle: kneeAngle
            };
          }, [calculateAngle]);

          // í¬ì¦ˆ ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
          const drawPoseLandmarks = useCallback((landmarks) => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // MediaPipe í¬ì¦ˆ ì—°ê²°ì„  ì •ì˜
            const connections = [
              [11, 12], // ì–´ê¹¨
              [11, 13], [13, 15], // ì™¼ìª½ íŒ”
              [12, 14], [14, 16], // ì˜¤ë¥¸ìª½ íŒ”
              [11, 23], [12, 24], // ëª¸í†µ
              [23, 24], // í—ˆë¦¬
              [23, 25], [25, 27], [27, 29], [27, 31], // ì™¼ìª½ ë‹¤ë¦¬
              [24, 26], [26, 28], [28, 30], [28, 32], // ì˜¤ë¥¸ìª½ ë‹¤ë¦¬
              [0, 1], [1, 2], [2, 3], [3, 7], // ì–¼êµ´ ì™¼ìª½
              [0, 4], [4, 5], [5, 6], [6, 8], // ì–¼êµ´ ì˜¤ë¥¸ìª½
              [9, 10] // ì…
            ];

            // ì—°ê²°ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = 2;
            ctx.beginPath();

            connections.forEach(([startIdx, endIdx]) => {
              const start = landmarks[startIdx];
              const end = landmarks[endIdx];
              
              if (start && end && start.visibility > 0.5 && end.visibility > 0.5) {
                const startX = start.x * canvas.width;
                const startY = start.y * canvas.height;
                const endX = end.x * canvas.width;
                const endY = end.y * canvas.height;
                
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
              }
            });
            
            ctx.stroke();

            // ì£¼ìš” ê´€ì ˆì  ê·¸ë¦¬ê¸°
            const keyPoints = [0, 11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28];
            ctx.fillStyle = '#FF0000';
            
            keyPoints.forEach(idx => {
              const landmark = landmarks[idx];
              if (landmark && landmark.visibility > 0.5) {
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
              }
            });
          }, []);

          // í¬ì¦ˆ ê²°ê³¼ ì²˜ë¦¬
          const onPoseResults = useCallback((results) => {
            if (results.poseLandmarks) {
              drawPoseLandmarks(results.poseLandmarks);
              const newMetrics = calculateRealPoseMetrics(results.poseLandmarks);
              
              // ì‘ì—… ê°•ë„ ëœë¤ ìƒì„± (ì‹¤ì œë¡œëŠ” ì›€ì§ì„ íŒ¨í„´ ë¶„ì„)
              const intensity = Math.random() > 0.7 ? 'ë†’ìŒ' : Math.random() > 0.3 ? 'ë³´í†µ' : 'ë‚®ìŒ';
              
              setMetrics({
                ...newMetrics,
                workIntensity: intensity
              });

              // ê¶Œì¥ì‚¬í•­ ì—…ë°ì´íŠ¸
              const newRecommendations = [];
              if (newMetrics.spineAngle < 160) {
                newRecommendations.push('í—ˆë¦¬ë¥¼ ê³§ê²Œ í´ê³  ì‘ì—…í•˜ì„¸ìš”.');
              }
              if (newMetrics.neckAngle > 15) {
                newRecommendations.push('ëª©ì„ ê³¼ë„í•˜ê²Œ ìˆ™ì´ì§€ ë§ˆì„¸ìš”.');
              }
              if (newMetrics.shoulderBalance > 5) {
                newRecommendations.push('ì–´ê¹¨ ë†’ì´ë¥¼ ê· ë“±í•˜ê²Œ ìœ ì§€í•˜ì„¸ìš”.');
              }
              if (newMetrics.kneeAngle < 150) {
                newRecommendations.push('ë¬´ë¦ì„ êµ¬ë¶€ë¦´ ë•ŒëŠ” ì„œì„œíˆ í•˜ì„¸ìš”.');
              }
              if (newRecommendations.length === 0) {
                newRecommendations.push('í˜„ì¬ ìì„¸ê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. ê³„ì† ìœ ì§€í•˜ì„¸ìš”!');
              }
              setRecommendations(newRecommendations);

              // ì „ì²´ ìƒíƒœ ì—…ë°ì´íŠ¸
              const statuses = [
                newMetrics.spineAngle > 160 ? 'good' : newMetrics.spineAngle > 140 ? 'warning' : 'danger',
                newMetrics.neckAngle < 15 ? 'good' : newMetrics.neckAngle < 25 ? 'warning' : 'danger',
                newMetrics.shoulderBalance < 5 ? 'good' : newMetrics.shoulderBalance < 10 ? 'warning' : 'danger',
                newMetrics.kneeAngle > 150 ? 'good' : newMetrics.kneeAngle > 120 ? 'warning' : 'danger'
              ];
              
              const dangerCount = statuses.filter(s => s === 'danger').length;
              const warningCount = statuses.filter(s => s === 'warning').length;

              if (dangerCount > 0) {
                setStatusMessage(`âš ï¸ ìœ„í—˜ ìš”ì†Œ ${dangerCount}ê°œ ê°ì§€ë¨`);
                setStatusType('danger');
              } else if (warningCount > 0) {
                setStatusMessage(`âš¡ ì£¼ì˜ ìš”ì†Œ ${warningCount}ê°œ ê°ì§€ë¨`);
                setStatusType('warning');
              } else {
                setStatusMessage('âœ… ì‘ì—… ìì„¸ ì–‘í˜¸');
                setStatusType('good');
              }
            } else {
              setStatusMessage('âš ï¸ ì‘ì—…ìê°€ ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¹´ë©”ë¼ ì•ì— ì„œì£¼ì„¸ìš”.');
              setStatusType('warning');
            }
          }, [drawPoseLandmarks, calculateRealPoseMetrics]);

          // MediaPipe ì´ˆê¸°í™”
          const initializePoseDetection = useCallback(async () => {
            if (typeof window !== 'undefined' && window.Pose) {
              poseRef.current = new window.Pose({
                locateFile: (file) => {
                  return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
              });
              
              poseRef.current.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: true,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
              });
              
              poseRef.current.onResults(onPoseResults);
              
              if (window.Camera && videoRef.current) {
                cameraRef.current = new window.Camera(videoRef.current, {
                  onFrame: async () => {
                    if (isRunning && poseRef.current) {
                      await poseRef.current.send({image: videoRef.current});
                    }
                  },
                  width: 1280,
                  height: 720
                });
              }
            }
          }, [onPoseResults, isRunning]);

          // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
          const resizeCanvas = useCallback(() => {
            if (videoRef.current && canvasRef.current) {
              const rect = videoRef.current.getBoundingClientRect();
              canvasRef.current.width = rect.width;
              canvasRef.current.height = rect.height;
            }
            
            if (snapshotCanvasRef.current) {
              snapshotCanvasRef.current.width = 300;
              snapshotCanvasRef.current.height = 200;
            }
          }, []);

          // ë¶„ì„ ì‹œì‘
          const startAnalysis = async () => {
            try {
              await initializePoseDetection();
              if (cameraRef.current) {
                await cameraRef.current.start();
              }
              
              setIsRunning(true);
              setShowMetrics(true);
              setShowRecommendations(true);
              
              if (hasValidApiKey) {
                setStatusMessage(`í³¹ ì‹¤ì‹œê°„ í¬ì¦ˆ ë¶„ì„ ì¤‘! ${config.selectedVLM.toUpperCase()} VLM ë¶„ì„ ì‚¬ìš© ê°€ëŠ¥`);
                setStatusType('good');
              } else {
                setStatusMessage('í³¹ ì‹¤ì‹œê°„ í¬ì¦ˆ ë¶„ì„ ì¤‘! (VLM ë¶„ì„ì€ API í‚¤ ì„¤ì • í›„ ê°€ëŠ¥)');
                setStatusType('warning');
              }
            } catch (error) {
              console.error('Error starting analysis:', error);
              setStatusMessage('í¬ì¦ˆ ê°ì§€ ì‹œì‘ ì‹¤íŒ¨. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.');
              setStatusType('danger');
            }
          };

          // ë¶„ì„ ì¤‘ì§€
          const stopAnalysis = () => {
            setIsRunning(false);
            setShowMetrics(false);
            setShowVLMAnalysis(false);
            setShowSnapshot(false);
            setShowRecommendations(false);
            
            if (cameraRef.current) {
              cameraRef.current.stop();
            }
            
            if (canvasRef.current) {
              const ctx = canvasRef.current.getContext('2d');
              ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
            }
            
            setStatusMessage('ë¶„ì„ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            setStatusType('good');
          };

          // ìŠ¤ëƒ…ìƒ· ìº¡ì²˜
          const captureSnapshot = () => {
            if (videoRef.current && snapshotCanvasRef.current) {
              const ctx = snapshotCanvasRef.current.getContext('2d');
              ctx.drawImage(videoRef.current, 0, 0, snapshotCanvasRef.current.width, snapshotCanvasRef.current.height);
            }
          };

          // VLM ë¶„ì„ ìˆ˜í–‰
          const performVLMAnalysis = async () => {
            if (!hasValidApiKey) {
              alert(`VLM ë¶„ì„ì„ ìœ„í•´ì„œëŠ” API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\nì½”ë“œì—ì„œ ë‹¤ìŒ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”:\nconfig.${config.selectedVLM}.apiKey = 'your-actual-api-key'`);
              return;
            }

            setIsAnalyzing(true);
            setShowVLMAnalysis(true);
            setShowSnapshot(true);
            
            captureSnapshot();
            
            try {
              // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì—¬ê¸°ì„œ VLM API í˜¸ì¶œ
              // ë°ëª¨ìš© ì‹œë®¬ë ˆì´ì…˜
              await new Promise(resolve => setTimeout(resolve, 3000));
              
              const scenarios = [
                {
                  analysis: "ì‘ì—…ìê°€ ì ì ˆí•œ ìŠ¤ì¿¼íŠ¸ ìì„¸ë¡œ ë¬´ê±°ìš´ ë¬¼ê±´ì„ ë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì²™ì¶”ê°€ ì¼ì§ì„ ì„ ìœ ì§€í•˜ê³  ìˆì–´ ì–‘í˜¸í•œ ìì„¸ì…ë‹ˆë‹¤.",
                  safety: "ì „ë°˜ì ìœ¼ë¡œ ì•ˆì „í•œ ìì„¸ì´ë‚˜, ë¬´ë¦ì´ ì•½ê°„ ì•ˆìª½ìœ¼ë¡œ ë“¤ì–´ê°„ ê²ƒì´ ê´€ì°°ë©ë‹ˆë‹¤. ì¥ì‹œê°„ ë°˜ë³µ ì‹œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
                  recommendations: "â€¢ ë¬´ë¦ì„ ë°œê°€ë½ ë°©í–¥ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìœ ì§€í•˜ì„¸ìš”\\nâ€¢ ì½”ì–´ ê·¼ìœ¡ì„ ë” ê°•í™”í•˜ì—¬ ì•ˆì •ì„±ì„ ë†’ì´ì„¸ìš”\\nâ€¢ ë¬´ê±°ìš´ ë¬¼ê±´ì„ ë“¤ ë•ŒëŠ” 2ì¸ 1ì¡°ë¡œ ì‘ì—…í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤"
                },
                {
                  analysis: "ì‘ì—…ìê°€ í—ˆë¦¬ë¥¼ êµ½íŒ ì±„ë¡œ ì‘ì—…í•˜ê³  ìˆì–´ ìš”ì¶”ì— ê³¼ë„í•œ ë¶€ë‹´ì´ ê°€í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ëª©ë„ ê³¼ë„í•˜ê²Œ ìˆ™ì—¬ì ¸ ìˆìŠµë‹ˆë‹¤.",
                  safety: "í˜„ì¬ ìì„¸ëŠ” ë†’ì€ ìœ„í—˜ë„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì§€ì†ë  ê²½ìš° ìš”í†µê³¼ ëª© ë””ìŠ¤í¬ ìœ„í—˜ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                  recommendations: "â€¢ ì¦‰ì‹œ í—ˆë¦¬ë¥¼ ê³§ê²Œ í´ê³  ì‘ì—…í•˜ì„¸ìš”\\nâ€¢ ì‘ì—…ëŒ€ ë†’ì´ë¥¼ ì¡°ì •í•˜ì—¬ ëª© ìœ„ì¹˜ë¥¼ ê°œì„ í•˜ì„¸ìš”\\nâ€¢ 30ë¶„ë§ˆë‹¤ ìŠ¤íŠ¸ë ˆì¹­ì„ ì‹¤ì‹œí•˜ì„¸ìš”\\nâ€¢ ì‘ì—… ìì„¸ êµìœ¡ì´ í•„ìš”í•©ë‹ˆë‹¤"
                },
                {
                  analysis: "ì‘ì—…ìê°€ ì–‘í˜¸í•œ ì„œ ìˆëŠ” ìì„¸ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì–´ê¹¨ê°€ ìˆ˜í‰ì„ ì´ë£¨ê³  ìˆê³  ì²™ì¶”ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ê³¡ì„ ì´ ì˜ ìœ ì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
                  safety: "í˜„ì¬ ìì„¸ëŠ” ë§¤ìš° ì•ˆì „í•©ë‹ˆë‹¤. ê·¼ê³¨ê²©ê³„ ë¶€ë‹´ì´ ìµœì†Œí™”ëœ ì´ìƒì ì¸ ì‘ì—… ìì„¸ì…ë‹ˆë‹¤.",
                  recommendations: "â€¢ í˜„ì¬ ìì„¸ë¥¼ ê³„ì† ìœ ì§€í•˜ì„¸ìš”\\nâ€¢ ì£¼ê¸°ì ìœ¼ë¡œ ì²´ì¤‘ì„ ì¢Œìš°ë¡œ ì´ë™ì‹œì¼œ í”¼ë¡œë¥¼ ì˜ˆë°©í•˜ì„¸ìš”\\nâ€¢ ë°œ ë°›ì¹¨ëŒ€ ì‚¬ìš©ì„ ê³ ë ¤í•´ë³´ì„¸ìš”\\nâ€¢ ë‹¤ë¥¸ ì‘ì—…ìë“¤ì—ê²Œ ëª¨ë²” ì‚¬ë¡€ë¡œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
                }
              ];

              const result = scenarios[Math.floor(Math.random() * scenarios.length)];
              
              setVlmAnalysis(`
                <div style="line-height: 1.6;">
                  <strong>í´ AI ì „ë¬¸ê°€ ë¶„ì„ ê²°ê³¼:</strong><br><br>
                  ${result.analysis}<br><br>
                  <strong>âš ï¸ ì•ˆì „ì„± í‰ê°€:</strong><br>
                  ${result.safety}<br><br>
                  <strong>í²ª ê¶Œì¥ ê°œì„ ì‚¬í•­:</strong><br>
                  ${result.recommendations}
                </div>
              `);

            } catch (error) {
              setVlmAnalysis(`
                <div style="color: #dc3545;">
                  âŒ VLM ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
                </div>
              `);
            } finally {
              setIsAnalyzing(false);
            }
          };

          // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì´ˆê¸°í™”
          useEffect(() => {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ì´ˆê¸° ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •
            if (hasValidApiKey) {
              setStatusMessage(`âœ… ${config.selectedVLM.toUpperCase()} API ì—°ê²° ì¤€ë¹„ ì™„ë£Œ! ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ì„¸ìš”.`);
              setStatusType('good');
            }
            
            return () => {
              window.removeEventListener('resize', resizeCanvas);
              if (cameraRef.current) {
                cameraRef.current.stop();
              }
            };
          }, [resizeCanvas, hasValidApiKey, config.selectedVLM]);

          // ë©”íŠ¸ë¦­ ìƒíƒœ ê³„ì‚° í•¨ìˆ˜
          const getMetricStatus = (value, thresholds) => {
            if (value >= thresholds.good) return 'good';
            if (value >= thresholds.warning) return 'warning';
            return 'danger';
          };

          return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 p-5" },
            React.createElement('div', { className: "max-w-7xl mx-auto" },
              // í—¤ë”
              React.createElement('div', { className: "bg-white/95 rounded-2xl p-6 text-center mb-5 shadow-2xl" },
                React.createElement('h1', { className: "text-4xl font-bold text-gray-800 mb-2" },
                  "í´– VLM í†µí•© ê³µì¥ ì‘ì—…ì í¬ì¦ˆ ë¶„ì„ ì‹œìŠ¤í…œ"
                ),
                React.createElement('p', { className: "text-xl text-gray-600" },
                  "ì‹¤ì‹œê°„ ì‘ì—…ì ì•ˆì „ ëª¨ë‹ˆí„°ë§ + AI ë¶„ì„ ë³´ê³ ì„œ"
                )
              ),

              // ë©”ì¸ ì»¨í…ì¸ 
              React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-5 h-[calc(100vh-200px)]" },
                // ë¹„ë””ì˜¤ ì„¹ì…˜
                React.createElement('div', { className: "lg:col-span-2 bg-white/95 rounded-2xl p-5 shadow-2xl flex flex-col" },
                  React.createElement('div', { className: "relative flex-1 rounded-xl overflow-hidden bg-black" },
                    React.createElement('h3', { className: "font-bold text-lg mb-2" }, "í³Š ì‹¤ì‹œê°„ ë¶„ì„ ìƒíƒœ"),
                    React.createElement('p', { className: "text-gray-700" }, statusMessage)
                  ),

                  // ì¸¡ì •ê°’ íŒ¨ë„
                  showMetrics && React.createElement('div', { className: "mb-4" },
                    React.createElement('h3', { className: "font-bold text-lg mb-3" }, "í³ ìì„¸ ì¸¡ì •ê°’"),
                    React.createElement('div', { className: "space-y-3" },
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì²™ì¶” ê°ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.spineAngle, {good: 160, warning: 140}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.spineAngle, {good: 160, warning: 140}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.spineAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ëª© ê¸°ìš¸ê¸°"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.neckAngle, {good: 15, warning: 25}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.neckAngle, {good: 15, warning: 25}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.neckAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì–´ê¹¨ ê· í˜•"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.shoulderBalance, {good: 5, warning: 10}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.shoulderBalance, {good: 5, warning: 10}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.shoulderBalance.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ë¬´ë¦ ê°ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.kneeAngle, {good: 150, warning: 120}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.kneeAngle, {good: 150, warning: 120}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.kneeAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì‘ì—… ê°•ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            metrics.workIntensity === 'ë‚®ìŒ' ? 'bg-green-100 text-green-800' :
                            metrics.workIntensity === 'ë³´í†µ' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, metrics.workIntensity)
                      )
                    )
                  ),

                  // VLM ë¶„ì„ íŒ¨ë„
                  showVLMAnalysis && React.createElement('div', { className: "bg-blue-50 rounded-xl p-4 mb-4 border-l-4 border-blue-500" },
                    React.createElement('h3', { className: "font-bold text-lg text-blue-800 mb-3 flex items-center gap-2" },
                      "í·  AI ì „ë¬¸ê°€ ë¶„ì„"
                    ),
                    isAnalyzing ? 
                      React.createElement('div', { className: "flex items-center gap-3 text-gray-600" },
                        React.createElement('div', { className: "w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" }),
                        React.createElement('span', { className: "italic" }, "AIê°€ ì‘ì—…ìì˜ ìì„¸ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...")
                      ) :
                      React.createElement('div', { 
                        className: "text-gray-700",
                        dangerouslySetInnerHTML: { __html: vlmAnalysis }
                      })
                  ),

                  // ìŠ¤ëƒ…ìƒ· ì„¹ì…˜
                  showSnapshot && React.createElement('div', { className: "bg-gray-50 rounded-xl p-4 mb-4" },
                    React.createElement('h3', { className: "font-bold text-lg text-gray-700 mb-3" }, "í³¸ ë¶„ì„ëœ ìŠ¤ëƒ…ìƒ·"),
                    React.createElement('canvas', { 
                      ref: snapshotCanvasRef,
                      className: "w-full max-w-xs border-2 border-gray-300 rounded-lg"
                    })
                  ),

                  // ê¶Œì¥ì‚¬í•­ íŒ¨ë„
                  showRecommendations && React.createElement('div', { className: "bg-blue-50 rounded-xl p-4" },
                    React.createElement('h3', { className: "font-bold text-lg text-blue-800 mb-3" }, "í¾¯ ê°œì„  ê¶Œì¥ì‚¬í•­"),
                    React.createElement('ul', { className: "space-y-2" },
                      recommendations.map((rec, index) => 
                        React.createElement('li', { key: index, className: "flex items-start gap-2 text-blue-700" },
                          React.createElement('span', { className: "text-blue-500" }, "í²¡"),
                          React.createElement('span', null, rec)
                        )
                      )
                    )
                  )
                )
              )
            )
          );
        };

        // ì•± ë Œë”ë§
        ReactDOM.render(React.createElement(WorkerPoseAnalyzer), document.getElementById('root'));
    </script>
</body>
</html>video', { 
                      ref: videoRef,
                      autoPlay: true, 
                      muted: true, 
                      playsInline: true,
                      className: "w-full h-full object-cover"
                    }),
                    React.createElement('canvas', { 
                      ref: canvasRef,
                      className: "absolute top-0 left-0 w-full h-full"
                    })
                  ),
                  
                  // ì»¨íŠ¸ë¡¤ ë²„íŠ¼
                  React.createElement('div', { className: "flex justify-center gap-4 mt-4" },
                    React.createElement('button', {
                      onClick: startAnalysis,
                      disabled: isRunning,
                      className: "px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, "ì¹´ë©”ë¼ ì‹œì‘"),
                    React.createElement('button', {
                      onClick: performVLMAnalysis,
                      disabled: !isRunning || isAnalyzing,
                      className: "px-6 py-3 bg-gradient-to-r from-blue-400 to-blue-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, isAnalyzing ? 'VLM ë¶„ì„ ì¤‘...' : 'VLM ë¶„ì„'),
                    React.createElement('button', {
                      onClick: stopAnalysis,
                      disabled: !isRunning,
                      className: "px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, "ì¤‘ì§€")
                  )
                ),

                // ë¶„ì„ íŒ¨ë„
                React.createElement('div', { className: "bg-white/95 rounded-2xl p-5 shadow-2xl overflow-y-auto" },
                  // ìƒíƒœ ì¹´ë“œ
                  React.createElement('div', { 
                    className: `rounded-xl p-4 mb-4 border-l-4 ${
                      statusType === 'good' ? 'bg-green-50 border-green-500' :
                      statusType === 'warning' ? 'bg-yellow-50 border-yellow-500' :
                      'bg-red-50 border-red-500'
                    }`
                  },
                    React.createElement('<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³µì¥ ì‘ì—…ì í¬ì¦ˆ ë¶„ì„ ì‹œìŠ¤í…œ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useCallback } = React;

        const WorkerPoseAnalyzer = () => {
          // State ê´€ë¦¬
          const [isRunning, setIsRunning] = useState(false);
          const [statusMessage, setStatusMessage] = useState('í´§ í¬ì¦ˆ ë¶„ì„ì€ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥, VLM ë¶„ì„ì€ API í‚¤ ì„¤ì • í›„ ê°€ëŠ¥');
          const [statusType, setStatusType] = useState('warning');
          const [showMetrics, setShowMetrics] = useState(false);
          const [showVLMAnalysis, setShowVLMAnalysis] = useState(false);
          const [showSnapshot, setShowSnapshot] = useState(false);
          const [showRecommendations, setShowRecommendations] = useState(false);
          const [metrics, setMetrics] = useState({
            spineAngle: 0,
            neckAngle: 0,
            shoulderBalance: 0,
            kneeAngle: 0,
            workIntensity: 'ë³´í†µ'
          });
          const [vlmAnalysis, setVlmAnalysis] = useState('');
          const [isAnalyzing, setIsAnalyzing] = useState(false);
          const [recommendations, setRecommendations] = useState([]);

          // Refs
          const videoRef = useRef(null);
          const canvasRef = useRef(null);
          const snapshotCanvasRef = useRef(null);
          const poseRef = useRef(null);
          const cameraRef = useRef(null);

          // í´‘ API ì„¤ì • (ì—¬ê¸°ì„œ ì§ì ‘ ìˆ˜ì •í•˜ì„¸ìš”!)
          const config = {
            // OpenAI GPT-4 Vision ì„¤ì •
            openai: {
              apiKey: 'sk-your-openai-api-key-here', // â† ì‹¤ì œ OpenAI API í‚¤ ì…ë ¥
              model: 'gpt-4-vision-preview'
            },
            
            // Google Gemini ì„¤ì •  
            gemini: {
              apiKey: 'your-gemini-api-key-here', // â† ì‹¤ì œ Gemini API í‚¤ ì…ë ¥
              model: 'gemini-pro-vision'
            },
            
            // Anthropic Claude ì„¤ì •
            claude: {
              apiKey: 'your-claude-api-key-here', // â† ì‹¤ì œ Claude API í‚¤ ì…ë ¥
              model: 'claude-3-sonnet-20240229'
            },
            
            // ì‚¬ìš©í•  VLM ì„ íƒ ('openai', 'gemini', 'claude')
            selectedVLM: 'openai'
          };

          const selectedConfig = config[config.selectedVLM];
          const hasValidApiKey = selectedConfig.apiKey && !selectedConfig.apiKey.includes('your-') && !selectedConfig.apiKey.includes('-here');

          // ê°ë„ ê³„ì‚° í•¨ìˆ˜
          const calculateAngle = useCallback((point1, point2, point3) => {
            const a = Math.sqrt(Math.pow(point2.x - point3.x, 2) + Math.pow(point2.y - point3.y, 2));
            const b = Math.sqrt(Math.pow(point1.x - point3.x, 2) + Math.pow(point1.y - point3.y, 2));
            const c = Math.sqrt(Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2));
            
            const angle = Math.acos((a * a + c * c - b * b) / (2 * a * c));
            return angle * 180 / Math.PI;
          }, []);

          // ì‹¤ì œ í¬ì¦ˆ ë©”íŠ¸ë¦­ ê³„ì‚°
          const calculateRealPoseMetrics = useCallback((landmarks) => {
            const leftShoulder = landmarks[11];
            const rightShoulder = landmarks[12];
            const leftHip = landmarks[23];
            const rightHip = landmarks[24];
            const nose = landmarks[0];
            const leftKnee = landmarks[25];
            const leftAnkle = landmarks[27];

            // ì²™ì¶” ê°ë„ ê³„ì‚°
            const shoulderMidpoint = {
              x: (leftShoulder.x + rightShoulder.x) / 2,
              y: (leftShoulder.y + rightShoulder.y) / 2
            };
            const hipMidpoint = {
              x: (leftHip.x + rightHip.x) / 2,
              y: (leftHip.y + rightHip.y) / 2
            };

            const spineAngle = calculateAngle(
              shoulderMidpoint,
              hipMidpoint,
              {x: hipMidpoint.x, y: hipMidpoint.y + 0.1}
            );

            // ëª© ê°ë„ ê³„ì‚°
            const neckAngle = calculateAngle(
              nose,
              shoulderMidpoint,
              {x: shoulderMidpoint.x, y: shoulderMidpoint.y + 0.1}
            );

            // ì–´ê¹¨ ê· í˜• ê³„ì‚°
            const shoulderBalance = Math.abs(leftShoulder.y - rightShoulder.y) * 180;

            // ë¬´ë¦ ê°ë„ ê³„ì‚°
            const kneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);

            return {
              spineAngle: 180 - Math.abs(spineAngle),
              neckAngle: Math.abs(neckAngle),
              shoulderBalance: shoulderBalance,
              kneeAngle: kneeAngle
            };
          }, [calculateAngle]);

          // í¬ì¦ˆ ëœë“œë§ˆí¬ ê·¸ë¦¬ê¸°
          const drawPoseLandmarks = useCallback((landmarks) => {
            const canvas = canvasRef.current;
            const ctx = canvas.getContext('2d');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // MediaPipe í¬ì¦ˆ ì—°ê²°ì„  ì •ì˜
            const connections = [
              [11, 12], // ì–´ê¹¨
              [11, 13], [13, 15], // ì™¼ìª½ íŒ”
              [12, 14], [14, 16], // ì˜¤ë¥¸ìª½ íŒ”
              [11, 23], [12, 24], // ëª¸í†µ
              [23, 24], // í—ˆë¦¬
              [23, 25], [25, 27], [27, 29], [27, 31], // ì™¼ìª½ ë‹¤ë¦¬
              [24, 26], [26, 28], [28, 30], [28, 32], // ì˜¤ë¥¸ìª½ ë‹¤ë¦¬
              [0, 1], [1, 2], [2, 3], [3, 7], // ì–¼êµ´ ì™¼ìª½
              [0, 4], [4, 5], [5, 6], [6, 8], // ì–¼êµ´ ì˜¤ë¥¸ìª½
              [9, 10] // ì…
            ];

            // ì—°ê²°ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#00FF00';
            ctx.lineWidth = 2;
            ctx.beginPath();

            connections.forEach(([startIdx, endIdx]) => {
              const start = landmarks[startIdx];
              const end = landmarks[endIdx];
              
              if (start && end && start.visibility > 0.5 && end.visibility > 0.5) {
                const startX = start.x * canvas.width;
                const startY = start.y * canvas.height;
                const endX = end.x * canvas.width;
                const endY = end.y * canvas.height;
                
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
              }
            });
            
            ctx.stroke();

            // ì£¼ìš” ê´€ì ˆì  ê·¸ë¦¬ê¸°
            const keyPoints = [0, 11, 12, 13, 14, 15, 16, 23, 24, 25, 26, 27, 28];
            ctx.fillStyle = '#FF0000';
            
            keyPoints.forEach(idx => {
              const landmark = landmarks[idx];
              if (landmark && landmark.visibility > 0.5) {
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
              }
            });
          }, []);

          // í¬ì¦ˆ ê²°ê³¼ ì²˜ë¦¬
          const onPoseResults = useCallback((results) => {
            if (results.poseLandmarks) {
              drawPoseLandmarks(results.poseLandmarks);
              const newMetrics = calculateRealPoseMetrics(results.poseLandmarks);
              
              // ì‘ì—… ê°•ë„ ëœë¤ ìƒì„± (ì‹¤ì œë¡œëŠ” ì›€ì§ì„ íŒ¨í„´ ë¶„ì„)
              const intensity = Math.random() > 0.7 ? 'ë†’ìŒ' : Math.random() > 0.3 ? 'ë³´í†µ' : 'ë‚®ìŒ';
              
              setMetrics({
                ...newMetrics,
                workIntensity: intensity
              });

              // ê¶Œì¥ì‚¬í•­ ì—…ë°ì´íŠ¸
              const newRecommendations = [];
              if (newMetrics.spineAngle < 160) {
                newRecommendations.push('í—ˆë¦¬ë¥¼ ê³§ê²Œ í´ê³  ì‘ì—…í•˜ì„¸ìš”.');
              }
              if (newMetrics.neckAngle > 15) {
                newRecommendations.push('ëª©ì„ ê³¼ë„í•˜ê²Œ ìˆ™ì´ì§€ ë§ˆì„¸ìš”.');
              }
              if (newMetrics.shoulderBalance > 5) {
                newRecommendations.push('ì–´ê¹¨ ë†’ì´ë¥¼ ê· ë“±í•˜ê²Œ ìœ ì§€í•˜ì„¸ìš”.');
              }
              if (newMetrics.kneeAngle < 150) {
                newRecommendations.push('ë¬´ë¦ì„ êµ¬ë¶€ë¦´ ë•ŒëŠ” ì„œì„œíˆ í•˜ì„¸ìš”.');
              }
              if (newRecommendations.length === 0) {
                newRecommendations.push('í˜„ì¬ ìì„¸ê°€ ì–‘í˜¸í•©ë‹ˆë‹¤. ê³„ì† ìœ ì§€í•˜ì„¸ìš”!');
              }
              setRecommendations(newRecommendations);

              // ì „ì²´ ìƒíƒœ ì—…ë°ì´íŠ¸
              const statuses = [
                newMetrics.spineAngle > 160 ? 'good' : newMetrics.spineAngle > 140 ? 'warning' : 'danger',
                newMetrics.neckAngle < 15 ? 'good' : newMetrics.neckAngle < 25 ? 'warning' : 'danger',
                newMetrics.shoulderBalance < 5 ? 'good' : newMetrics.shoulderBalance < 10 ? 'warning' : 'danger',
                newMetrics.kneeAngle > 150 ? 'good' : newMetrics.kneeAngle > 120 ? 'warning' : 'danger'
              ];
              
              const dangerCount = statuses.filter(s => s === 'danger').length;
              const warningCount = statuses.filter(s => s === 'warning').length;

              if (dangerCount > 0) {
                setStatusMessage(`âš ï¸ ìœ„í—˜ ìš”ì†Œ ${dangerCount}ê°œ ê°ì§€ë¨`);
                setStatusType('danger');
              } else if (warningCount > 0) {
                setStatusMessage(`âš¡ ì£¼ì˜ ìš”ì†Œ ${warningCount}ê°œ ê°ì§€ë¨`);
                setStatusType('warning');
              } else {
                setStatusMessage('âœ… ì‘ì—… ìì„¸ ì–‘í˜¸');
                setStatusType('good');
              }
            } else {
              setStatusMessage('âš ï¸ ì‘ì—…ìê°€ ê°ì§€ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¹´ë©”ë¼ ì•ì— ì„œì£¼ì„¸ìš”.');
              setStatusType('warning');
            }
          }, [drawPoseLandmarks, calculateRealPoseMetrics]);

          // MediaPipe ì´ˆê¸°í™”
          const initializePoseDetection = useCallback(async () => {
            if (typeof window !== 'undefined' && window.Pose) {
              poseRef.current = new window.Pose({
                locateFile: (file) => {
                  return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
                }
              });
              
              poseRef.current.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                smoothSegmentation: true,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
              });
              
              poseRef.current.onResults(onPoseResults);
              
              if (window.Camera && videoRef.current) {
                cameraRef.current = new window.Camera(videoRef.current, {
                  onFrame: async () => {
                    if (isRunning && poseRef.current) {
                      await poseRef.current.send({image: videoRef.current});
                    }
                  },
                  width: 1280,
                  height: 720
                });
              }
            }
          }, [onPoseResults, isRunning]);

          // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì •
          const resizeCanvas = useCallback(() => {
            if (videoRef.current && canvasRef.current) {
              const rect = videoRef.current.getBoundingClientRect();
              canvasRef.current.width = rect.width;
              canvasRef.current.height = rect.height;
            }
            
            if (snapshotCanvasRef.current) {
              snapshotCanvasRef.current.width = 300;
              snapshotCanvasRef.current.height = 200;
            }
          }, []);

          // ë¶„ì„ ì‹œì‘
          const startAnalysis = async () => {
            try {
              await initializePoseDetection();
              if (cameraRef.current) {
                await cameraRef.current.start();
              }
              
              setIsRunning(true);
              setShowMetrics(true);
              setShowRecommendations(true);
              
              if (hasValidApiKey) {
                setStatusMessage(`í³¹ ì‹¤ì‹œê°„ í¬ì¦ˆ ë¶„ì„ ì¤‘! ${config.selectedVLM.toUpperCase()} VLM ë¶„ì„ ì‚¬ìš© ê°€ëŠ¥`);
                setStatusType('good');
              } else {
                setStatusMessage('í³¹ ì‹¤ì‹œê°„ í¬ì¦ˆ ë¶„ì„ ì¤‘! (VLM ë¶„ì„ì€ API í‚¤ ì„¤ì • í›„ ê°€ëŠ¥)');
                setStatusType('warning');
              }
            } catch (error) {
              console.error('Error starting analysis:', error);
              setStatusMessage('í¬ì¦ˆ ê°ì§€ ì‹œì‘ ì‹¤íŒ¨. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”.');
              setStatusType('danger');
            }
          };

          // ë¶„ì„ ì¤‘ì§€
          const stopAnalysis = () => {
            setIsRunning(false);
            setShowMetrics(false);
            setShowVLMAnalysis(false);
            setShowSnapshot(false);
            setShowRecommendations(false);
            
            if (cameraRef.current) {
              cameraRef.current.stop();
            }
            
            if (canvasRef.current) {
              const ctx = canvasRef.current.getContext('2d');
              ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);
            }
            
            setStatusMessage('ë¶„ì„ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            setStatusType('good');
          };

          // ìŠ¤ëƒ…ìƒ· ìº¡ì²˜
          const captureSnapshot = () => {
            if (videoRef.current && snapshotCanvasRef.current) {
              const ctx = snapshotCanvasRef.current.getContext('2d');
              ctx.drawImage(videoRef.current, 0, 0, snapshotCanvasRef.current.width, snapshotCanvasRef.current.height);
            }
          };

          // VLM ë¶„ì„ ìˆ˜í–‰
          const performVLMAnalysis = async () => {
            if (!hasValidApiKey) {
              alert(`VLM ë¶„ì„ì„ ìœ„í•´ì„œëŠ” API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.\n\nì½”ë“œì—ì„œ ë‹¤ìŒ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ì„¸ìš”:\nconfig.${config.selectedVLM}.apiKey = 'your-actual-api-key'`);
              return;
            }

            setIsAnalyzing(true);
            setShowVLMAnalysis(true);
            setShowSnapshot(true);
            
            captureSnapshot();
            
            try {
              // ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ì—¬ê¸°ì„œ VLM API í˜¸ì¶œ
              // ë°ëª¨ìš© ì‹œë®¬ë ˆì´ì…˜
              await new Promise(resolve => setTimeout(resolve, 3000));
              
              const scenarios = [
                {
                  analysis: "ì‘ì—…ìê°€ ì ì ˆí•œ ìŠ¤ì¿¼íŠ¸ ìì„¸ë¡œ ë¬´ê±°ìš´ ë¬¼ê±´ì„ ë“¤ê³  ìˆìŠµë‹ˆë‹¤. ì²™ì¶”ê°€ ì¼ì§ì„ ì„ ìœ ì§€í•˜ê³  ìˆì–´ ì–‘í˜¸í•œ ìì„¸ì…ë‹ˆë‹¤.",
                  safety: "ì „ë°˜ì ìœ¼ë¡œ ì•ˆì „í•œ ìì„¸ì´ë‚˜, ë¬´ë¦ì´ ì•½ê°„ ì•ˆìª½ìœ¼ë¡œ ë“¤ì–´ê°„ ê²ƒì´ ê´€ì°°ë©ë‹ˆë‹¤. ì¥ì‹œê°„ ë°˜ë³µ ì‹œ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
                  recommendations: "â€¢ ë¬´ë¦ì„ ë°œê°€ë½ ë°©í–¥ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìœ ì§€í•˜ì„¸ìš”\\nâ€¢ ì½”ì–´ ê·¼ìœ¡ì„ ë” ê°•í™”í•˜ì—¬ ì•ˆì •ì„±ì„ ë†’ì´ì„¸ìš”\\nâ€¢ ë¬´ê±°ìš´ ë¬¼ê±´ì„ ë“¤ ë•ŒëŠ” 2ì¸ 1ì¡°ë¡œ ì‘ì—…í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤"
                },
                {
                  analysis: "ì‘ì—…ìê°€ í—ˆë¦¬ë¥¼ êµ½íŒ ì±„ë¡œ ì‘ì—…í•˜ê³  ìˆì–´ ìš”ì¶”ì— ê³¼ë„í•œ ë¶€ë‹´ì´ ê°€í•´ì§€ê³  ìˆìŠµë‹ˆë‹¤. ëª©ë„ ê³¼ë„í•˜ê²Œ ìˆ™ì—¬ì ¸ ìˆìŠµë‹ˆë‹¤.",
                  safety: "í˜„ì¬ ìì„¸ëŠ” ë†’ì€ ìœ„í—˜ë„ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì§€ì†ë  ê²½ìš° ìš”í†µê³¼ ëª© ë””ìŠ¤í¬ ìœ„í—˜ì´ ì¦ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                  recommendations: "â€¢ ì¦‰ì‹œ í—ˆë¦¬ë¥¼ ê³§ê²Œ í´ê³  ì‘ì—…í•˜ì„¸ìš”\\nâ€¢ ì‘ì—…ëŒ€ ë†’ì´ë¥¼ ì¡°ì •í•˜ì—¬ ëª© ìœ„ì¹˜ë¥¼ ê°œì„ í•˜ì„¸ìš”\\nâ€¢ 30ë¶„ë§ˆë‹¤ ìŠ¤íŠ¸ë ˆì¹­ì„ ì‹¤ì‹œí•˜ì„¸ìš”\\nâ€¢ ì‘ì—… ìì„¸ êµìœ¡ì´ í•„ìš”í•©ë‹ˆë‹¤"
                },
                {
                  analysis: "ì‘ì—…ìê°€ ì–‘í˜¸í•œ ì„œ ìˆëŠ” ìì„¸ë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì–´ê¹¨ê°€ ìˆ˜í‰ì„ ì´ë£¨ê³  ìˆê³  ì²™ì¶”ì˜ ìì—°ìŠ¤ëŸ¬ìš´ ê³¡ì„ ì´ ì˜ ìœ ì§€ë˜ì–´ ìˆìŠµë‹ˆë‹¤.",
                  safety: "í˜„ì¬ ìì„¸ëŠ” ë§¤ìš° ì•ˆì „í•©ë‹ˆë‹¤. ê·¼ê³¨ê²©ê³„ ë¶€ë‹´ì´ ìµœì†Œí™”ëœ ì´ìƒì ì¸ ì‘ì—… ìì„¸ì…ë‹ˆë‹¤.",
                  recommendations: "â€¢ í˜„ì¬ ìì„¸ë¥¼ ê³„ì† ìœ ì§€í•˜ì„¸ìš”\\nâ€¢ ì£¼ê¸°ì ìœ¼ë¡œ ì²´ì¤‘ì„ ì¢Œìš°ë¡œ ì´ë™ì‹œì¼œ í”¼ë¡œë¥¼ ì˜ˆë°©í•˜ì„¸ìš”\\nâ€¢ ë°œ ë°›ì¹¨ëŒ€ ì‚¬ìš©ì„ ê³ ë ¤í•´ë³´ì„¸ìš”\\nâ€¢ ë‹¤ë¥¸ ì‘ì—…ìë“¤ì—ê²Œ ëª¨ë²” ì‚¬ë¡€ë¡œ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
                }
              ];

              const result = scenarios[Math.floor(Math.random() * scenarios.length)];
              
              setVlmAnalysis(`
                <div style="line-height: 1.6;">
                  <strong>í´ AI ì „ë¬¸ê°€ ë¶„ì„ ê²°ê³¼:</strong><br><br>
                  ${result.analysis}<br><br>
                  <strong>âš ï¸ ì•ˆì „ì„± í‰ê°€:</strong><br>
                  ${result.safety}<br><br>
                  <strong>í²ª ê¶Œì¥ ê°œì„ ì‚¬í•­:</strong><br>
                  ${result.recommendations}
                </div>
              `);

            } catch (error) {
              setVlmAnalysis(`
                <div style="color: #dc3545;">
                  âŒ VLM ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}
                </div>
              `);
            } finally {
              setIsAnalyzing(false);
            }
          };

          // ì»´í¬ë„ŒíŠ¸ ë§ˆìš´íŠ¸ ì‹œ ì´ˆê¸°í™”
          useEffect(() => {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // ì´ˆê¸° ìƒíƒœ ë©”ì‹œì§€ ì„¤ì •
            if (hasValidApiKey) {
              setStatusMessage(`âœ… ${config.selectedVLM.toUpperCase()} API ì—°ê²° ì¤€ë¹„ ì™„ë£Œ! ì¹´ë©”ë¼ë¥¼ ì‹œì‘í•˜ì„¸ìš”.`);
              setStatusType('good');
            }
            
            return () => {
              window.removeEventListener('resize', resizeCanvas);
              if (cameraRef.current) {
                cameraRef.current.stop();
              }
            };
          }, [resizeCanvas, hasValidApiKey, config.selectedVLM]);

          // ë©”íŠ¸ë¦­ ìƒíƒœ ê³„ì‚° í•¨ìˆ˜
          const getMetricStatus = (value, thresholds) => {
            if (value >= thresholds.good) return 'good';
            if (value >= thresholds.warning) return 'warning';
            return 'danger';
          };

          return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-indigo-500 to-purple-600 p-5" },
            React.createElement('div', { className: "max-w-7xl mx-auto" },
              // í—¤ë”
              React.createElement('div', { className: "bg-white/95 rounded-2xl p-6 text-center mb-5 shadow-2xl" },
                React.createElement('h1', { className: "text-4xl font-bold text-gray-800 mb-2" },
                  "í´– VLM í†µí•© ê³µì¥ ì‘ì—…ì í¬ì¦ˆ ë¶„ì„ ì‹œìŠ¤í…œ"
                ),
                React.createElement('p', { className: "text-xl text-gray-600" },
                  "ì‹¤ì‹œê°„ ì‘ì—…ì ì•ˆì „ ëª¨ë‹ˆí„°ë§ + AI ë¶„ì„ ë³´ê³ ì„œ"
                )
              ),

              // ë©”ì¸ ì»¨í…ì¸ 
              React.createElement('div', { className: "grid grid-cols-1 lg:grid-cols-3 gap-5 h-[calc(100vh-200px)]" },
                // ë¹„ë””ì˜¤ ì„¹ì…˜
                React.createElement('div', { className: "lg:col-span-2 bg-white/95 rounded-2xl p-5 shadow-2xl flex flex-col" },
                  React.createElement('div', { className: "relative flex-1 rounded-xl overflow-hidden bg-black" },
                    React.createElement('h3', { className: "font-bold text-lg mb-2" }, "í³Š ì‹¤ì‹œê°„ ë¶„ì„ ìƒíƒœ"),
                    React.createElement('p', { className: "text-gray-700" }, statusMessage)
                  ),

                  // ì¸¡ì •ê°’ íŒ¨ë„
                  showMetrics && React.createElement('div', { className: "mb-4" },
                    React.createElement('h3', { className: "font-bold text-lg mb-3" }, "í³ ìì„¸ ì¸¡ì •ê°’"),
                    React.createElement('div', { className: "space-y-3" },
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì²™ì¶” ê°ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.spineAngle, {good: 160, warning: 140}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.spineAngle, {good: 160, warning: 140}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.spineAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ëª© ê¸°ìš¸ê¸°"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.neckAngle, {good: 15, warning: 25}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.neckAngle, {good: 15, warning: 25}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.neckAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì–´ê¹¨ ê· í˜•"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.shoulderBalance, {good: 5, warning: 10}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.shoulderBalance, {good: 5, warning: 10}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.shoulderBalance.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2 border-b border-gray-200" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ë¬´ë¦ ê°ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            getMetricStatus(metrics.kneeAngle, {good: 150, warning: 120}) === 'good' ? 'bg-green-100 text-green-800' :
                            getMetricStatus(metrics.kneeAngle, {good: 150, warning: 120}) === 'warning' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, `${metrics.kneeAngle.toFixed(1)}Â°`)
                      ),
                      
                      React.createElement('div', { className: "flex justify-between items-center py-2" },
                        React.createElement('span', { className: "font-semibold text-gray-700" }, "ì‘ì—… ê°•ë„"),
                        React.createElement('span', { 
                          className: `px-2 py-1 rounded-full text-sm font-bold ${
                            metrics.workIntensity === 'ë‚®ìŒ' ? 'bg-green-100 text-green-800' :
                            metrics.workIntensity === 'ë³´í†µ' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                          }`
                        }, metrics.workIntensity)
                      )
                    )
                  ),

                  // VLM ë¶„ì„ íŒ¨ë„
                  showVLMAnalysis && React.createElement('div', { className: "bg-blue-50 rounded-xl p-4 mb-4 border-l-4 border-blue-500" },
                    React.createElement('h3', { className: "font-bold text-lg text-blue-800 mb-3 flex items-center gap-2" },
                      "í·  AI ì „ë¬¸ê°€ ë¶„ì„"
                    ),
                    isAnalyzing ? 
                      React.createElement('div', { className: "flex items-center gap-3 text-gray-600" },
                        React.createElement('div', { className: "w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin" }),
                        React.createElement('span', { className: "italic" }, "AIê°€ ì‘ì—…ìì˜ ìì„¸ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...")
                      ) :
                      React.createElement('div', { 
                        className: "text-gray-700",
                        dangerouslySetInnerHTML: { __html: vlmAnalysis }
                      })
                  ),

                  // ìŠ¤ëƒ…ìƒ· ì„¹ì…˜
                  showSnapshot && React.createElement('div', { className: "bg-gray-50 rounded-xl p-4 mb-4" },
                    React.createElement('h3', { className: "font-bold text-lg text-gray-700 mb-3" }, "í³¸ ë¶„ì„ëœ ìŠ¤ëƒ…ìƒ·"),
                    React.createElement('canvas', { 
                      ref: snapshotCanvasRef,
                      className: "w-full max-w-xs border-2 border-gray-300 rounded-lg"
                    })
                  ),

                  // ê¶Œì¥ì‚¬í•­ íŒ¨ë„
                  showRecommendations && React.createElement('div', { className: "bg-blue-50 rounded-xl p-4" },
                    React.createElement('h3', { className: "font-bold text-lg text-blue-800 mb-3" }, "í¾¯ ê°œì„  ê¶Œì¥ì‚¬í•­"),
                    React.createElement('ul', { className: "space-y-2" },
                      recommendations.map((rec, index) => 
                        React.createElement('li', { key: index, className: "flex items-start gap-2 text-blue-700" },
                          React.createElement('span', { className: "text-blue-500" }, "í²¡"),
                          React.createElement('span', null, rec)
                        )
                      )
                    )
                  )
                )
              )
            )
          );
        };

        // ì•± ë Œë”ë§
        ReactDOM.render(React.createElement(WorkerPoseAnalyzer), document.getElementById('root'));
    </script>
</body>
</html>video', { 
                      ref: videoRef,
                      autoPlay: true, 
                      muted: true, 
                      playsInline: true,
                      className: "w-full h-full object-cover"
                    }),
                    React.createElement('canvas', { 
                      ref: canvasRef,
                      className: "absolute top-0 left-0 w-full h-full"
                    })
                  ),
                  
                  // ì»¨íŠ¸ë¡¤ ë²„íŠ¼
                  React.createElement('div', { className: "flex justify-center gap-4 mt-4" },
                    React.createElement('button', {
                      onClick: startAnalysis,
                      disabled: isRunning,
                      className: "px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, "ì¹´ë©”ë¼ ì‹œì‘"),
                    React.createElement('button', {
                      onClick: performVLMAnalysis,
                      disabled: !isRunning || isAnalyzing,
                      className: "px-6 py-3 bg-gradient-to-r from-blue-400 to-blue-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, isAnalyzing ? 'VLM ë¶„ì„ ì¤‘...' : 'VLM ë¶„ì„'),
                    React.createElement('button', {
                      onClick: stopAnalysis,
                      disabled: !isRunning,
                      className: "px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-full transition-all duration-300 hover:transform hover:-translate-y-1 hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
                    }, "ì¤‘ì§€")
                  )
                ),

                // ë¶„ì„ íŒ¨ë„
                React.createElement('div', { className: "bg-white/95 rounded-2xl p-5 shadow-2xl overflow-y-auto" },
                  // ìƒíƒœ ì¹´ë“œ
                  React.createElement('div', { 
                    className: `rounded-xl p-4 mb-4 border-l-4 ${
                      statusType === 'good' ? 'bg-green-50 border-green-500' :
                      statusType === 'warning' ? 'bg-yellow-50 border-yellow-500' :
                      'bg-red-50 border-red-500'
                    }`
                  },
                    React.createElement('
